const CATS={math:{toRadians:function(t){return t*(Math.PI/180)},EPSILON:1e-4,printAsMatrix:function(t){var a=t.data;console.log(a[0],a[4],a[8],a[12]),console.log(a[1],a[5],a[9],a[13]),console.log(a[2],a[6],a[10],a[14]),console.log(a[3],a[7],a[11],a[15])},vec3:{normalize:function(t){return thing=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),thing?[t[0]/thing,t[1]/thing,t[2]/thing]:[0,0,0]},add:function(t,a){return[t[0]+a[0],t[1]+a[1],t[2]+a[2]]},subtract:function(t,a){return[t[0]-a[0],t[1]-a[1],t[2]-a[2]]},cross:function(t,a){return[t[1]*a[2]-t[2]*a[1],t[2]*a[0]-t[0]*a[2],t[0]*a[1]-t[1]*a[0]]},dot:function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},hypot:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},multiplyByNumber:function(t,a){return[t[0]*a,t[1]*a,t[2]*a]},divideByNumber:function(t,a){return[t[0]/a,t[1]/a,t[2]/a]},invert:function(t){return[-1*t[0],-1*t[1],-1*t[2]]},lengthOf:function(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2)}},triangle:{getSurfaceNormal:function(t,a,e){var r=CATS.math.vec3.subtract(a,t),i=CATS.math.vec3.subtract(e,t);return CATS.math.vec3.normalize(CATS.math.vec3.cross(r,i))}},oneOver255:1/255},enum:{TRIANGLE_STRIP:0,TRIANGLES:1,POINT_CLOUD:2,LINES:3,ATTRIBUTE:4,UNIFORM:5,NON_ATTRIBUTE:6,ARRAYS:7,ELEMENTS:8,USES_COLOR_BUFFER:9,USES_TEXTURE_BUFFER:10,USES_NO_BUFFER:11,RGBA:12,FRIENDLY_RGBA:13,RGB:14,FRIENDLY_RGB:15,HEX:16,HSV:17,ARRAY_BUFFER:21,ELEMENT_ARRAY_BUFFER:22,DISABLE_DEPTH_TEST:23,DISABLE_CULL_FACE:24,DISABLE_AUTO_ADJUST_ASPECT_RATIO:25,DISABLE_ALPHA_BLEND:26,MESH:18,LIGHT:19,DIRECTIONAL_LIGHT:20},Color(t){if(t instanceof Array){if(3==t.length)return[t[0]*this.math.oneOver255,t[1]*this.math.oneOver255,t[2]*this.math.oneOver255];if(4==t.length)return[t[0]*this.math.oneOver255,t[1]*this.math.oneOver255,t[2]*this.math.oneOver255,t[3]];throw new TypeError(`Oops! It looks like CATS does not know what kind of color you are using.\nThe length of you array is: ${t.length}`)}if("string"!=typeof t)throw new TypeError(`Oops! It looks like CATS cannot parse this data type.\nData type: ${t.constructor}`);if(t.startsWith("#")){var a=t.slice(1);return[h=parseInt(a.slice(0,2),16)*this.math.oneOver255,o=parseInt(a.slice(2,4),16)*this.math.oneOver255,d=parseInt(a.slice(4,6),16)*this.math.oneOver255,1]}if(t.startsWith("rgb")){var e=t.slice(3),r=[0,0,0,1];e.startsWith("a")&&(e=t.slice(1)),e=(e=e.replaceAll(/"("|")"|";"/gi)).split(",");for(var i=0;i<e.length;i++)if(3!=i){var s=parseInt(e[i]);r[i]=s*this.math.oneOver255}else r[i]=parseFloat(e[i]);return r}if(t.startsWith("hsv")){var n=t.slice(3);n=(n=n.replaceAll(/"("|")"|";"/gi)).split(",");for(i=0;i<3;i++)n[i]=parseFloat(n[i]);if(n[0]>360||n[0]<0||n[1]>100||n[1]<0||n[2]>100||n[2]<0)throw new TypeError("Oops! It looks like this color's values seems to be out of range.");n[0]=n[0]/360;var h,o,d,c=n[0],l=n[1],m=n[2],u=6*c-(i=Math.floor(6*n[0])),g=m*(1-l),f=m*(1-u*l),p=m*(1-(1-u)*l);switch(i%6){case 0:h=m,o=p,d=g;break;case 1:h=f,o=m,d=g;break;case 2:h=g,o=m,d=p;break;case 3:h=g,o=f,d=m;break;case 4:h=p,o=g,d=m;break;case 5:h=m,o=g,d=f}return[h,o,d,1]}}};Object.freeze(CATS);class Renderer{constructor(t,a,e,r,i){this.canvas=t,this.gl=t.getContext("webgl2"),null===this.gl&&(console.warn("WebGL2 Not supported, falling back to WebGL1.\nSome features may break."),this.gl=t.getContext("webgl"),null===this.gl&&(console.warn("WebGL1 Not supported, falling back to experimental WebGL.\nSome features may break. We recommend using an up-to-date browser."),this.gl=t.getcontext("experimental-webgl"))),a||(this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL)),e||this.gl.enable(this.gl.CULL_FACE),i||(this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),this.aspect=t.clientWidth/t.clientHeight,r||this.canvas.addEventListener("resize",(function(){this.aspect=t.clientWidth/t.clientHeight}))}clear(t,a,e,r){this.gl.clearColor(t,a,e,r),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}drawPackage(t){var a,e={0:this.gl.TRIANGLE_STRIP,1:this.gl.TRIANGLES,2:this.gl.POINTS,3:this.gl.LINES},r=t.shaderProgram.program;a=t.renderType?e[t.renderType]:e[1];for(var i=t.bufferList,s=0;s<i.length;s++)i[s].enableForProgram(r);if(this.gl.useProgram(r),t.uniformList){var n=t.uniformList;for(s=0;s<n.length;s++)n[s].enableForProgram(r)}switch(t.drawingMethod){case CATS.enum.ELEMENTS:this.gl.drawElements(a,t.params.numElements,this.gl.UNSIGNED_SHORT,t.params.offset);break;case CATS.enum.ARRAYS:this.gl.drawArrays(a,0,t.params.numElements)}}}class Scene{constructor(t){this.renderer=t,this.camera={position:[0,0,0],direction:[0,0,0],fovy:70,near:CATS.math.EPSILON,far:100,lastViewMatrix:new Mat4,viewMatrixInitialized:!1},this.objects=[],this.lights=[],this.bgcolor=[0,0,0,1],this.lighting={maxLightSourcesPerMesh:1e3}}moveCamera(t){this.camera.position=CATS.math.vec3.add(this.camera.position,t),this.camera.viewMatrixInitialized=!1}rotateCamera(t){this.camera.direction=CATS.math.vec3.add(this.camera.direction,t),this.camera.viewMatrixInitialized=!1}setFOV(t){this.camera.fovy=t}projectCamera(){if(this.camera.viewMatrixInitialized)n=this.camera.lastViewMatrix;else{var t=[0,0,-1],a=[0,1,0],e=Math.sin(CATS.math.toRadians(this.camera.direction[2])),r=Math.cos(CATS.math.toRadians(this.camera.direction[2])),i=t[0],s=t[1];t[0]=i*r-s*e,t[1]=i*e+s*r,i=a[0],s=a[1],a[0]=i*r-s*e,a[1]=i*e+s*r;e=Math.sin(CATS.math.toRadians(this.camera.direction[1])),r=Math.cos(CATS.math.toRadians(this.camera.direction[1])),i=t[0],s=t[2];t[0]=i*r-s*e,t[2]=i*e+s*r;i=a[0],s=a[2];a[0]=i*r-s*e,a[2]=i*e+s*r;e=Math.sin(CATS.math.toRadians(this.camera.direction[0])),r=Math.cos(CATS.math.toRadians(this.camera.direction[0])),i=t[2],s=t[1];t[2]=i*r-s*e,t[1]=i*e+s*r;var n;i=a[2],s=a[1];a[2]=i*r-s*e,a[1]=i*e+s*r,(n=new Mat4).lookAt(this.camera.position,CATS.math.vec3.add(this.camera.position,t),a),this.camera.lastViewMatrix=n,this.camera.viewMatrixInitialized=!0}var h=new Mat4;return h.perspective(this.camera.fovy,this.renderer.aspect,this.camera.near,this.camera.far),{viewMatrix:n,projectionMatrix:h}}addObject(t){return this.objects.push(t),this.objects.length-1}addLight(t){return this.lights.push(t),this.lights.length-1}removeObject(t){this.objects.splice(t,1)}removeLight(t){this.lights.splice(t,1)}clear(){this.objects=[]}setBackground(t){t.startsWith("#")&&(this.bgcolor=CATS.hex2rgb(t))}render(){this.renderer.clear(...this.bgcolor);for(var t=this.projectCamera(),a=[],e=[],r={directional:0,point:0,spot:0},i=0;i<this.lights.length;i++){var s=this.lights[i].convertToData();if(s.type===CATS.enum.DIRECTIONAL_LIGHT)a.push(...s.divector),r.directional++}if(a.length){var n=new UniformVector4(this.renderer,a,"lightDirection");e.push(n)}var h=new UniformVector3(this.renderer,[r.directional,r.point,r.spot],"lightCounts");e.push(h);for(i=0;i<this.objects.length;i++)try{var o=this.objects[i].convertToPackage(this.renderer,t.viewMatrix,t.projectionMatrix,e,this);this.renderer.drawPackage(o,o.typeOfRender)}catch(t){throw new Error(`An error occoured while trying to process object #${i} in scene.\n\n${t.stack}`)}}}class Mesh{constructor(t,a,e,r,i){if(r)this.normals=i,this.vertices=t,this.indices=a;else{this.vertices=[],this.indices=[],this.normals=[];for(var s=t,n=0;n<a.length/3;n++){var h=[3*a[3*n],3*a[3*n+1],3*a[3*n+2]],o=[[s[h[0]],s[h[0]+1],s[h[0]+2]],[s[h[1]],s[h[1]+1],s[h[1]+2]],[s[h[2]],s[h[2]+1],s[h[2]+2]]],d=CATS.math.triangle.getSurfaceNormal(...o);this.vertices.push(...o[0],...o[1],...o[2]),this.normals.push(...d,...d,...d),this.indices.push(3*n,3*n+1,3*n+2)}}this.material=e,this.visible=!0,this.tags=void 0,this.transform={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],transformStayedSame:!1,transformMatrix:null,normalMatrix:null}}addTag(t){this.tags.push(t)}removeTag(){this.tag=void 0}scale(t){this.transform.scale=t,this.transform.transformStayedSame=!1}rotate(t){this.transform.rotation=CATS.math.vec3.add(t,this.transform.rotation),this.transform.transformStayedSame=!1}translate(t){this.transform.position=CATS.math.vec3.add(t,this.transform.position),this.transform.transformStayedSame=!1}setMaterial(t){this.material=t}convertToPackage(t,a,e,r,i){if(!this.transform.transformStayedSame){var s=new Mat4;s.scale(this.transform.scale),s.rotate(this.transform.rotation),s.translate(this.transform.position),this.transform.transformMatrix=s,this.transform.transformStayedSame=!0;var n=new Mat4;n.set(s),n.invert(),n.transpose(),this.transform.normalMatrix=n}for(var h,o=this.material.build(t,this,i),d=o.shaderProgram,c=o.parameters,l=[],m=0;m<c.length;m++)h=new c[m].type(t,c[m].value,c[m].attribute),l.push(h);var u=new PositionBuffer(t,this.vertices,"vP"),g=new IndexBuffer(t,this.indices),f=[u,new PositionBuffer(t,this.normals,"vN"),g,new Uniform4x4Matrix(t,this.transform.transformMatrix,"wM"),new Uniform4x4Matrix(t,a,"vM"),new Uniform4x4Matrix(t,e,"pM"),new Uniform4x4Matrix(t,this.transform.normalMatrix,"nM")];return f=(f=f.concat(l)).concat(r),new RenderablePackage(d,f,CATS.enum.ELEMENTS,CATS.enum.TRIANGLES,{numElements:this.indices.length,offset:0})}}class DirectionalLight{constructor(t,a,e){this.direction=t,this.color=CATS.Color(a),this.intensity=e}computeDirection(t){var a,e,r,i,s,n;a=[0,0,-1],e={x:t[0],y:t[1],z:t[2]},r=Math.sin(CATS.math.toRadians(e.z)),i=Math.cos(CATS.math.toRadians(e.z)),s=a[0],n=[1],a[0]=s*i-n*r,a[1]=s*r+n*i,s=a[0],n=a[2],a[0]=s*i-n*r,a[2]=s*r+n*i,s=a[2],n=a[1],a[2]=s*i-n*r,a[0]=s*r+n*i,this.direction=a}changeDirection(t){this.computeDirection(t)}convertToData(){return{divector:[...this.direction,this.intensity],color:this.color,type:CATS.enum.DIRECTIONAL_LIGHT}}}class Cube extends Mesh{constructor(t,a){super([-t,t,-t,t,t,-t,-t,-t,-t,t,-t,-t,-t,t,t,t,t,t,-t,-t,t,t,-t,t,-t,t,t,-t,t,-t,-t,-t,t,-t,-t,-t,t,-t,t,t,-t,-t,t,t,t,t,t,-t,-t,t,t,t,t,t,-t,t,-t,t,t,-t,-t,-t,-t,t,-t,-t,-t,-t,t,t,-t,t],[3,2,0,0,1,3,4,6,7,7,5,4,11,10,8,8,9,11,15,14,12,12,13,15,17,19,16,19,18,16,21,23,20,23,22,20],a)}}class Sphere extends Mesh{constructor(t,a,e){for(var r=[],i=[],s=0;s<=a;s++)for(var n=s*Math.PI/a,h=Math.sin(n),o=Math.cos(n),d=0;d<=a;d++){var c=2*d*Math.PI/a,l=Math.sin(c),m=Math.cos(c);r.push(t*l*h),r.push(t*o),r.push(t*m*h)}for(s=0;s<a;s++)for(d=0;d<a;d++){var u=s*(a+1)+d,g=u+(a+1);i.push(u),i.push(g),i.push(u+1),i.push(u+1),i.push(g),i.push(g+1)}super(r,i,e)}}class Plane extends Mesh{constructor(t,a){super([t,0,t,-t,0,t,-t,0,-t,t,0,-t],[0,1,2,1,3,2],a,!1)}}class VertexShader{constructor(t){this.source=t}compile(t){const a=t.gl,e=a.createShader(t.gl.VERTEX_SHADER);if(a.shaderSource(e,this.source),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw new Error(`An error occurred while compiling the vertex shader: ${a.getShaderInfoLog(e)}`);return e}}class FragmentShader{constructor(t){this.source=t}compile(t){const a=t.gl,e=a.createShader(t.gl.FRAGMENT_SHADER);if(a.shaderSource(e,this.source),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw new Error(`An error occurred while compiling the fragment shader: ${a.getShaderInfoLog(e)}`);return e}}class ShaderProgram{constructor(t,a,e,r){const i=t.gl,s=a.compile(t),n=e.compile(t),h=i.createProgram();if(i.attachShader(h,s),i.attachShader(h,n),i.linkProgram(h),!i.getProgramParameter(h,i.LINK_STATUS))throw new Error(`An error occurred while validating the program: ${i.getProgramInfoLog(h)}`);if(r&&(i.validateProgram(h),!i.getProgramParameter(h,i.VALIDATE_STATUS)))throw new Error(`An error occurred while validating the program: ${i.getProgramInfoLog(h)}`);this.program=h}}class Buffer{constructor(t,a,e,r,i){r.usageType||(this.usageType=CATS.enum.ARRAY_BUFFER),r.type?this.type=r.type:this.type=CATS.enum.ATTRIBUTE,this.renderer=t,this.data=a,this.attribute=r.attribute,this.usageType={21:this.renderer.gl.ARRAY_BUFFER,22:this.renderer.gl.ELEMENT_ARRAY_BUFFER}[r.usageType];const s=this.renderer.gl,n=s.createBuffer();this.params=r,s.bindBuffer(this.usageType,n),s.bufferData(this.usageType,e?new e(a):new Float32Array(a),i||s.STATIC_DRAW),this.buffer=n}enableForProgram(t){if(this.type==CATS.enum.ATTRIBUTE){var a=this.renderer.gl.getAttribLocation(t,this.attribute);this.renderer.gl.bindBuffer(this.usageType,this.buffer),this.renderer.gl.vertexAttribPointer(a,this.params.vertexAttribParams.numberOfComponents,this.params.vertexAttribParams.type,this.params.vertexAttribParams.normalize,this.params.vertexAttribParams.stride,this.params.vertexAttribParams.offset),this.renderer.gl.enableVertexAttribArray(a)}else this.renderer.gl.bindBuffer(this.usageType,this.buffer)}}class PositionBuffer extends Buffer{constructor(t,a,e){super(t,a,Float32Array,{vertexAttribParams:{numberOfComponents:3,type:t.gl.FLOAT,normalize:t.gl.FALSE,stride:3*Float32Array.BYTES_PER_ELEMENT,offset:0},usageType:CATS.enum.ARRAY_BUFFER,type:CATS.enum.ATTRIBUTE,attribute:e})}}class IndexBuffer extends Buffer{constructor(t,a){super(t,a,Uint16Array,{usageType:CATS.enum.ELEMENT_ARRAY_BUFFER,type:CATS.enum.NON_ATTRIBUTE})}}class Uniform4x4Matrix{constructor(t,a,e){this.matrix=a,this.attribute=e,this.render=t,this.tag=CATS.enum.UNIFORM}enableForProgram(t){this.render.gl.uniformMatrix4fv(this.render.gl.getUniformLocation(t,this.attribute),this.render.gl.FALSE,this.matrix.data)}}class UniformVector3{constructor(t,a,e){this.vector=a,this.attribute=e,this.render=t,this.tag=CATS.enum.UNIFORM}enableForProgram(t){this.render.gl.uniform3fv(this.render.gl.getUniformLocation(t,this.attribute),new Float32Array(this.vector))}}class UniformVector4{constructor(t,a,e){this.vector=a,this.attribute=e,this.render=t,this.tag=CATS.enum.UNIFORM}enableForProgram(t){this.render.gl.uniform4fv(this.render.gl.getUniformLocation(t,this.attribute),new Float32Array(this.vector))}}class UniformInt{constructor(t,a,e){this.value=a,this.attribute=e,this.render=t,this.tag=CATS.enum.UNIFORM}enableForProgram(t){this.render.gl.uniform1i(this.render.gl.getUniformLocation(t,this.attribute),this.value)}}class RenderablePackage{constructor(t,a,e,r,i){this.shaderProgram=t,this.bufferList=[],this.uniformList=[];for(var s=0;s<a.length;s++)a[s].tag===CATS.enum.UNIFORM?this.uniformList.push(a[s]):a[s].tag||this.bufferList.push(a[s]);this.drawingMethod=e,this.renderType=r,this.params=i}}class Material{constructor(t,a){this.lastCompiled=!1,this.compiled=null,this.params=t,a||(a=function(t,a,e,r){if(r.lastCompiled)return r.compiled;{let a="\n    precision mediump float;\n    varying mediump vec3 fN;\n    void main(void){\n        gl_FragColor = vec3(1.0,0.0,1.0,1.0);\n    }\n    ",e=new VertexShader("\n    precision mediump float;\n    attribute vec3 vP;\n    attribute vec3 vN;\n    uniform mat4 wM;\n    uniform mat4 vM;\n    uniform mat4 pM;\n    uniform mat4 nM;\n    varying mediump vec3 fN;\n    void main(void){\n        vec3 newVN = vec3(nM*vec4(vN,1.0));\n        gl_Position = pM*vM*wM*vec4(vP,1.0);\n        fN = newVN;\n    }\n    "),i=new FragmentShader(a),s=new ShaderProgram(t,e,i);return r.lastCompiled=!0,r.compiled={shaderProgram:s,parameters:[]},r.compiled}}),this.build=function(t,e,r){return a(t,e,r,this)}}resetBuild(){this.lastCompiled=!1,this.compiled=null}}class SingleColorMaterial extends Material{constructor(t,a){super([t,a],(function(t,a,e,r){if(r.lastCompiled)return r.compiled;{let a="precision mediump float;\nattribute vec3 vP;\nattribute vec3 vN;\nuniform mat4 wM;\nuniform mat4 vM;\nuniform mat4 pM;\nuniform mat4 nM;\nvarying mediump vec3 fN;\nvoid main(void){\n    gl_Position = pM*vM*wM*vec4(vP,1.0);\n    fN = (wM*vec4(vN,0.0)).xyz;\n}\n",i=`\n#define MAXLIGHTSOURCES ${e.lighting.maxLightSourcesPerMesh}\nprecision mediump float;\nvarying mediump vec3 fN;\nuniform vec4 lightDirection[MAXLIGHTSOURCES];\nuniform vec3 lightCounts;\nuniform vec4 objectColor;\nvoid main(void){\n    int ndLights = int(lightCounts.x);\n    if(ndLights>8){\n        ndLights = 8;\n    }\n    vec3 normal = normalize(fN);\n    float light = 0.0;\n    for(int i=0; i<MAXLIGHTSOURCES; i++){\n        if(i>=ndLights){\n            break;\n        }\n        float increment = dot(normal,lightDirection[i].xyz*lightDirection[i].w);\n        if(increment<0.0){\n            increment = 0.0;\n        }\n        light+=increment;\n    }\n    if(light > 1.0){\n        light = 1.0;\n    } else if(light<0.0){\n        light = 0.0;\n    }\n    gl_FragColor = objectColor;\n    gl_FragColor.rgb*=light;\n}`,s=new VertexShader(a),n=new FragmentShader(i),h=new ShaderProgram(t,s,n);return r.lastCompiled=!0,r.compiled={shaderProgram:h,parameters:[{type:UniformVector4,value:CATS.Color(r.params[0]),attribute:"objectColor"}]},r.compiled}}))}}class Mat4{constructor(){this.data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.length=16}multiply(t){if(t instanceof Mat4){for(var a=new Mat4,e=0;e<4;e++)for(var r=0;r<4;r++){a.data[4*e+r]=0;for(var i=0;i<4;i++)a.data[4*e+r]+=this.data[4*e+i]*t.data[4*i+r]}this.set(a)}else if(t instanceof Array){var s=t,n=this.data;return[s[0]*n[0]+s[1]*n[4]+s[2]*n[8]+s[3]*n[12],s[0]*n[1]+s[1]*n[5]+s[2]*n[9]+s[3]*n[13],s[0]*n[2]+s[1]*n[6]+s[2]*n[10]+s[3]*n[14],s[0]*n[3]+s[1]*n[7]+s[2]*n[11]+s[3]*n[15]]}}add(t,a){this.data[0]=t[0]+a[0],this.data[1]=t[1]+a[1],this.data[2]=t[2]+a[2],this.data[3]=t[3]+a[3],this.data[4]=t[4]+a[4],this.data[5]=t[5]+a[5],this.data[6]=t[6]+a[6],this.data[7]=t[7]+a[7],this.data[8]=t[8]+a[8],this.data[9]=t[9]+a[9],this.data[10]=t[10]+a[10],this.data[11]=t[11]+a[11],this.data[12]=t[12]+a[12],this.data[13]=t[13]+a[13],this.data[14]=t[14]+a[14],this.data[15]=t[15]+a[15]}identity(){this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=1,this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=1,this.data[11]=0,this.data[12]=0,this.data[13]=0,this.data[14]=0,this.data[15]=1}subtract(t,a){this.data[0]=t[0]-a[0],this.data[1]=t[1]-a[1],this.data[2]=t[2]-a[2],this.data[3]=t[3]-a[3],this.data[4]=t[4]-a[4],this.data[5]=t[5]-a[5],this.data[6]=t[6]-a[6],this.data[7]=t[7]-a[7],this.data[8]=t[8]-a[8],this.data[9]=t[9]-a[9],this.data[10]=t[10]-a[10],this.data[11]=t[11]-a[11],this.data[12]=t[12]-a[12],this.data[13]=t[13]-a[13],this.data[14]=t[14]-a[14],this.data[15]=t[15]-a[15]}set(t,a,e,r,i,s,n,h,o,d,c,l,m,u,g,f){if(!t instanceof Mat4)this.data[0]=t,this.data[1]=a,this.data[2]=e,this.data[3]=r,this.data[4]=i,this.data[5]=s,this.data[6]=n,this.data[7]=h,this.data[8]=o,this.data[9]=d,this.data[10]=c,this.data[11]=l,this.data[12]=m,this.data[13]=u,this.data[14]=g,this.data[15]=f;else for(var p=0;p<16;p++)this.data[p]=t.data[p]}perspective(t,a,e,r){var i,s,n,h;s=-(i=e*Math.tan(CATS.math.toRadians(t)/2)),n=-(h=i*a),this.data[0]=2*e/(h-n),this.data[1]=0,this.data[2]=(h+n)/(h-n),this.data[3]=0,this.data[4]=0,this.data[5]=2*e/(i-s),this.data[6]=(i+s)/(i-s),this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=-(r+e)/(r-e),this.data[11]=-1,this.data[12]=0,this.data[13]=0,this.data[14]=-2*r*e/(r-e),this.data[15]=0}translate(t){var a=new Mat4;a.data[12]=t[0],a.data[13]=t[1],a.data[14]=t[2],this.multiply(a)}rotate(t){var[a,e,r]=t;a=CATS.math.toRadians(a),e=CATS.math.toRadians(e),r=CATS.math.toRadians(r);var i,s,n=new Mat4;i=Math.cos(r),s=Math.sin(r),n.data[0]=i,n.data[1]=-s,n.data[4]=s,n.data[5]=i;var h=new Mat4;i=Math.cos(e),s=Math.sin(e),h.data[0]=i,h.data[2]=s,h.data[8]=-s,h.data[10]=i;var o=new Mat4;i=Math.cos(a),s=Math.sin(a),o.data[5]=i,o.data[6]=-s,o.data[9]=s,o.data[10]=i;var d=new Mat4;n.multiply(h),d.multiply(n),d.multiply(o),this.multiply(d)}scale(t){var a=new Mat4;a.data[0]=t[0],a.data[5]=t[1],a.data[10]=t[2],this.multiply(a)}lookAt(t,a,e){let r,i,s,n,h;s=CATS.math.vec3.subtract(t,a),Math.abs(t[0]-a[0])<CATS.math.EPSILON&&Math.abs(t[1]-a[1])<CATS.math.EPSILON&&Math.abs(t[2]-a[2])<CATS.math.EPSILON&&this.identity(),h=1/Math.hypot(s[0],s[1],s[2]),s=CATS.math.vec3.multiplyByNumber(s,h),r=CATS.math.vec3.cross(e,s),i=CATS.math.vec3.cross(s,r),n=new Mat4,n.data[0]=r[0],n.data[1]=i[0],n.data[2]=s[0],n.data[3]=0,n.data[4]=r[1],n.data[5]=i[1],n.data[6]=s[1],n.data[7]=0,n.data[8]=r[2],n.data[9]=i[2],n.data[10]=s[2],n.data[11]=0,n.data[12]=-CATS.math.vec3.dot(r,t),n.data[13]=-CATS.math.vec3.dot(i,t),n.data[14]=-CATS.math.vec3.dot(s,t),n.data[15]=1,this.multiply(n)}invert(){let t=this.data[0],a=this.data[1],e=this.data[2],r=this.data[3],i=this.data[4],s=this.data[5],n=this.data[6],h=this.data[7],o=this.data[8],d=this.data[9],c=this.data[10],l=this.data[11],m=this.data[12],u=this.data[13],g=this.data[14],f=this.data[15],p=t*s-a*i,v=t*n-e*i,S=t*h-r*i,T=a*n-e*s,A=a*h-r*s,M=e*h-r*n,b=o*u-d*m,E=o*g-c*m,C=o*f-l*m,R=d*g-c*u,w=d*f-l*u,y=c*f-l*g,L=p*y-v*w+S*R+T*C-A*E+M*b;L||this.identity(),L=1/L,this.data[0]=(s*y-n*w+h*R)*L,this.data[1]=(e*w-a*y-r*R)*L,this.data[2]=(u*M-g*A+f*T)*L,this.data[3]=(c*A-d*M-l*T)*L,this.data[4]=(n*C-i*y-h*E)*L,this.data[5]=(t*y-e*C+r*E)*L,this.data[6]=(g*S-m*M-f*v)*L,this.data[7]=(o*M-c*S+l*v)*L,this.data[8]=(i*w-s*C+h*b)*L,this.data[9]=(a*C-t*w-r*b)*L,this.data[10]=(m*A-u*S+f*p)*L,this.data[11]=(d*S-o*A-l*p)*L,this.data[12]=(s*E-i*R-n*b)*L,this.data[13]=(t*R-a*E+e*b)*L,this.data[14]=(u*v-m*T-g*p)*L,this.data[15]=(o*T-d*v+c*p)*L}transpose(){this.data[0]=this.data[0],this.data[1]=this.data[4],this.data[2]=this.data[8],this.data[3]=this.data[12],this.data[4]=this.data[1],this.data[5]=this.data[5],this.data[6]=this.data[9],this.data[7]=this.data[13],this.data[8]=this.data[2],this.data[9]=this.data[6],this.data[10]=this.data[10],this.data[11]=this.data[14],this.data[12]=this.data[3],this.data[13]=this.data[7],this.data[14]=this.data[11],this.data[15]=this.data[15]}}